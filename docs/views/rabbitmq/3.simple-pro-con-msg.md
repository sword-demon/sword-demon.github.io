---
title: 简单生产消息和消费消息
date: 2023-01-07 00:20:10
category: RabbitMQ
tag:
    - RabbitMQ
---

# 简单生产消息和消费消息

## 生产者发送消息

```go
package main

import (
	"fmt"
	"github.com/streadway/amqp"
	"log"
)

func main() {
	dsn := fmt.Sprintf("amqp://%s:%s@%s:%d", "wxviurs", "123", "127.0.0.1", 5672)
	conn, err := amqp.Dial(dsn)
	if err != nil {
		log.Fatalln(err)
	}
	defer conn.Close()
	// 创建 channel
	c, err := conn.Channel()
	if err != nil {
		log.Fatalln(err)
	}
	defer c.Close()

	// 创建队列
	queue, err := c.QueueDeclare("test", false, false, false, false, nil)
	if err != nil {
		log.Fatalln(err)
	}

	// 使用channel发布消息
	err = c.Publish("", queue.Name, false, false,
		amqp.Publishing{
			ContentType: "text/plain",       // 消息类型
			Body:        []byte("test0001"), // 消息内容
		})
	if err != nil {
		log.Fatalln(err)
	}
	log.Println("发生消息成功")
}

```

![image-20230107001807167](https://virusoss.oss-cn-shanghai.aliyuncs.com/images/image-20230107001807167.png)

我这里发送了 2 次，这里的`idle`表示空闲状态，`Total`有 2 个消息，队列名为`test`
