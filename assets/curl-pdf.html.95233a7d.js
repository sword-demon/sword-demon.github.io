import{_ as n}from"./plugin-vue_export-helper.21dcd24c.js";import{o as s,c as a,e as t}from"./app.d55bb37b.js";const p={},e=t(`<h2 id="\u8FDC\u7A0B\u8C03\u7528\u643A\u5E26-token-\u4E0B\u8F7D-pdf" tabindex="-1"><a class="header-anchor" href="#\u8FDC\u7A0B\u8C03\u7528\u643A\u5E26-token-\u4E0B\u8F7D-pdf" aria-hidden="true">#</a> \u8FDC\u7A0B\u8C03\u7528\u643A\u5E26 Token \u4E0B\u8F7D PDF</h2><div class="language-php ext-php line-numbers-mode"><pre class="language-php"><code><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">function_exists</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;downFile&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token doc-comment comment">/**
     * \u4E0B\u8F7D\u987A\u4E30\u4E91\u6253\u5370\u9762\u5355\u8FDC\u7A0BPDF
     * <span class="token keyword">@param</span> <span class="token parameter">$url</span> string \u8FDC\u7AEF\u6587\u4EF6\u8DEF\u5F84
     * <span class="token keyword">@param</span> <span class="token parameter">$savePath</span> string \u4FDD\u5B58\u672C\u5730\u6587\u4EF6\u8DEF\u5F84
     * <span class="token keyword">@param</span> <span class="token parameter">$token</span> string token
     * <span class="token keyword">@return</span> <span class="token class-name"><span class="token keyword">string</span></span>
     */</span>
    <span class="token keyword">function</span> <span class="token function-definition function">downFile</span><span class="token punctuation">(</span><span class="token variable">$url</span><span class="token punctuation">,</span> <span class="token variable">$savePath</span><span class="token punctuation">,</span> <span class="token variable">$token</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$ch</span> <span class="token operator">=</span> <span class="token function">curl_init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">curl_setopt</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">,</span> <span class="token constant">CURLOPT_SSL_VERIFYPEER</span><span class="token punctuation">,</span> <span class="token constant boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//\u5173\u95ED\u5BF9\u7B49\u8BC1\u4E66</span>
        <span class="token function">curl_setopt</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">,</span> <span class="token constant">CURLOPT_URL</span><span class="token punctuation">,</span> <span class="token variable">$url</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//\u8BF7\u6C42\u5730\u5740</span>
        <span class="token function">curl_setopt</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">,</span> <span class="token constant">CURLOPT_RETURNTRANSFER</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">curl_setopt</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">,</span> <span class="token constant">CURLOPT_HTTPHEADER</span><span class="token punctuation">,</span> <span class="token keyword">array</span><span class="token punctuation">(</span>
            <span class="token string single-quoted-string">&#39;X-Auth-token: &#39;</span><span class="token operator">.</span><span class="token variable">$token</span>
        <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">curl_setopt</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">,</span> <span class="token constant">CURLOPT_HEADER</span><span class="token punctuation">,</span> <span class="token constant boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//\u8FD4\u56DE\u5934\u90E8\u4FE1\u606F</span>
        <span class="token comment">//\u9700\u8981response header</span>
        <span class="token function">curl_setopt</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">,</span> <span class="token constant">CURLOPT_NOBODY</span><span class="token punctuation">,</span> <span class="token constant boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//\u9700\u8981response body</span>
        <span class="token variable">$response</span> <span class="token operator">=</span> <span class="token function">curl_exec</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//\u5206\u79BBheader\u4E0Ebody</span>
        <span class="token variable">$header</span> <span class="token operator">=</span> <span class="token string single-quoted-string">&#39;&#39;</span><span class="token punctuation">;</span>
        <span class="token variable">$body</span> <span class="token operator">=</span> <span class="token string single-quoted-string">&#39;&#39;</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">curl_getinfo</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">,</span> <span class="token constant">CURLINFO_HTTP_CODE</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string single-quoted-string">&#39;200&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token variable">$headerSize</span> <span class="token operator">=</span> <span class="token function">curl_getinfo</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">,</span> <span class="token constant">CURLINFO_HEADER_SIZE</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//\u5934\u4FE1\u606Fsize</span>
            <span class="token variable">$header</span> <span class="token operator">=</span> <span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$response</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token variable">$headerSize</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token variable">$body</span> <span class="token operator">=</span> <span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$response</span><span class="token punctuation">,</span> <span class="token variable">$headerSize</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token function">curl_close</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//\u6587\u4EF6\u540D</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;&#39;</span> <span class="token operator">!=</span> <span class="token variable">$body</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token function">date</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;YmdHis&#39;</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string single-quoted-string">&#39;.pdf&#39;</span><span class="token punctuation">;</span>
            <span class="token variable">$fullName</span> <span class="token operator">=</span> <span class="token function">rtrim</span><span class="token punctuation">(</span><span class="token variable">$savePath</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">&#39;/&#39;</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string single-quoted-string">&#39;/&#39;</span><span class="token operator">.</span><span class="token variable">$file</span><span class="token punctuation">;</span>
            <span class="token comment">//\u521B\u5EFA\u76EE\u5F55\u5E76\u8BBE\u7F6E\u6743\u9650</span>
            <span class="token variable">$basePath</span> <span class="token operator">=</span> <span class="token function">dirname</span><span class="token punctuation">(</span><span class="token variable">$fullName</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">file_exists</span><span class="token punctuation">(</span><span class="token variable">$basePath</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                @<span class="token function">mkdir</span><span class="token punctuation">(</span><span class="token variable">$basePath</span><span class="token punctuation">,</span> <span class="token number">0777</span><span class="token punctuation">,</span> <span class="token constant boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                @<span class="token function">chmod</span><span class="token punctuation">(</span><span class="token variable">$basePath</span><span class="token punctuation">,</span> <span class="token number">0777</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">file_put_contents</span><span class="token punctuation">(</span><span class="token variable">$fullName</span><span class="token punctuation">,</span> <span class="token variable">$body</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token variable">$file</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">return</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="custom-container info"><p class="custom-container-title">\u6CE8\u610F</p><p>\u8FD9\u91CC\u7684\u751F\u6210\u7684<code>$file</code>\u7684\u540D\u79F0\u5982\u679C\u662F\u591A\u4E2A\u8BF7\u6C42\u4E0B\u8F7D\uFF0C\u53EF\u80FD\u4F1A\u540D\u79F0\u91CD\u590D\uFF0C\u8FD8\u9700\u8981\u8BBE\u7F6E\u4E00\u4E2A\u4E0D\u91CD\u590D\u7684\u540D\u79F0\u6BD4\u8F83\u4FDD\u9669</p></div>`,3),o=[e];function c(l,i){return s(),a("div",null,o)}var r=n(p,[["render",c],["__file","curl-pdf.html.vue"]]);export{r as default};
