import{_ as d}from"./plugin-vue_export-helper.21dcd24c.js";import{r as c,o as l,c as t,a as n,b as a,e as s,d as e}from"./app.75f63fbd.js";const p={},r=s('<h1 id="kubernetes-\u5165\u95E8" tabindex="-1"><a class="header-anchor" href="#kubernetes-\u5165\u95E8" aria-hidden="true">#</a> Kubernetes \u5165\u95E8</h1><h2 id="\u57FA\u672C\u6982\u5FF5" tabindex="-1"><a class="header-anchor" href="#\u57FA\u672C\u6982\u5FF5" aria-hidden="true">#</a> \u57FA\u672C\u6982\u5FF5</h2><ul><li><code>Pod</code>\uFF1A\u5B9E\u4F8B\uFF0C\u91CC\u9762\u53EF\u4EE5\u5B89\u88C5<code>mysql</code>\uFF0C\u7B49\u5185\u5BB9\u3002</li><li><code>Service</code>: \u903B\u8F91\u4E0A\u7684\u670D\u52A1\uFF0C\u53EF\u4EE5\u8BA4\u4E3A\u8FD9\u4E2A\u662F\u4F60\u4E1A\u52A1\u4E0A<code>XXX</code>\u670D\u52A1\u7684\u76F4\u63A5\u6620\u5C04</li><li><code>Deployment</code>: \u7BA1\u7406<code>Pod</code>\u7684\u4E1C\u897F</li></ul><p><code>Pod</code>\u548C<code>Service</code>\u6700\u7B80\u7684\u7406\u89E3\u65B9\u5F0F\uFF1A\u4F60\u6709\u4E00\u4E2A<code>web</code>\u5E94\u7528\uFF0C\u90E8\u7F72\u4E86 3 \u4E2A\u5B9E\u4F8B\uFF0C\u90A3\u4E48\u5C31\u662F\u4E00\u4E2A<code>Web Service</code>\uFF0C\u5BF9\u5E94\u4E86 3 \u4E2A<code>Pod</code></p><p><code>Deployment</code>\u6700\u597D\u7684\u7406\u89E3\u65B9\u5F0F\uFF1A\u8FD0\u7EF4\u4FDD\u8BC1<code>Web</code>\u6709 3 \u4E2A\u5B9E\u4F8B\uFF0C\u5C11\u4E86\u5C31\u91CD\u542F\u4E00\u4E2A\uFF0C\u591A\u4E86\u5C31\u5220\u9664\u4E00\u4E2A\uFF0C\u90A3\u4E48\u8FD0\u7EF4\u5C31\u662F\u8FD9\u4E2A<code>Deployment</code>\u3002</p><div class="custom-container tip"><p class="custom-container-title">\u63D0\u793A</p><p>\u8FD9\u91CC\u6211\u4EEC\u76F4\u63A5\u4F7F\u7528<code>Docker Desktop</code>\u91CC\u7684<code>Kubernetes</code>\u70B9\u51FB<code>Enable Kubenetes</code>\uFF1B<code>windows</code>\u7CFB\u7EDF\u7684\u5F97\u9700\u8981\u4E13\u4E1A\u7248\uFF0C\u4E14\u5F00\u542F\u865A\u62DF\u5316\uFF0C\u8FD8\u5F97\u79D1\u5B66\u4E0A\u7F51\u3002</p></div><h2 id="\u5B89\u88C5kubectl-\u5DE5\u5177" tabindex="-1"><a class="header-anchor" href="#\u5B89\u88C5kubectl-\u5DE5\u5177" aria-hidden="true">#</a> \u5B89\u88C5kubectl \u5DE5\u5177</h2>',7),u=e("\u6253\u5F00\u7F51\u7AD9"),k={href:"https://kubernetes.io/docs/tasks/tools/",target:"_blank",rel:"noopener noreferrer"},v=e("https://kubernetes.io/docs/tasks/tools/"),m=e("\uFF0C\u6267\u884C\u5BF9\u5E94\u7684\u547D\u4EE4\u5373\u53EF\u3002"),b=s(`<h2 id="\u4F7F\u7528-rancher-\u5B89\u88C5" tabindex="-1"><a class="header-anchor" href="#\u4F7F\u7528-rancher-\u5B89\u88C5" aria-hidden="true">#</a> \u4F7F\u7528 Rancher \u5B89\u88C5</h2><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">sudo</span> <span class="token function">docker</span> run --privileged -d --restart<span class="token operator">=</span>unless-stopped -p <span class="token number">80</span>:80 -p <span class="token number">443</span>:443 rancher/rancher
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>\u9700\u8981\u7B49\u4E00\u6BB5\u65F6\u95F4\uFF0C\u770B\u7535\u8111\u6027\u80FD\u3002</p><h2 id="\u4F7F\u7528-k8s-\u90E8\u7F72web\u670D\u52A1\u5668" tabindex="-1"><a class="header-anchor" href="#\u4F7F\u7528-k8s-\u90E8\u7F72web\u670D\u52A1\u5668" aria-hidden="true">#</a> \u4F7F\u7528 K8S \u90E8\u7F72web\u670D\u52A1\u5668</h2><h3 id="\u6539\u9020" tabindex="-1"><a class="header-anchor" href="#\u6539\u9020" aria-hidden="true">#</a> \u6539\u9020</h3><p>\u6211\u4EEC\u5148\u628A\u4F9D\u8D56\u7684<code>redis</code>\u548C<code>MySQL</code>\u53BB\u6389</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">//db := initDB()</span>
	<span class="token comment">//server := initWebServer()</span>
	<span class="token comment">//</span>
	<span class="token comment">//userHandle := initUserHdl(db)</span>
	<span class="token comment">//userHandle.RegisterRoutes(server)</span>

	server <span class="token operator">:=</span> gin<span class="token punctuation">.</span><span class="token function">Default</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    server<span class="token punctuation">.</span><span class="token function">GET</span><span class="token punctuation">(</span><span class="token string">&quot;/hello&quot;</span><span class="token punctuation">,</span> <span class="token keyword">func</span><span class="token punctuation">(</span>c <span class="token operator">*</span>gin<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		c<span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span>StatusOK<span class="token punctuation">,</span> <span class="token string">&quot;\u8FD9\u662F hello world&quot;</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
	err <span class="token operator">:=</span> server<span class="token punctuation">.</span><span class="token function">Run</span><span class="token punctuation">(</span><span class="token string">&quot;:9093&quot;</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		log<span class="token punctuation">.</span><span class="token function">Fatalln</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
		<span class="token keyword">return</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="\u90E8\u7F72\u65B9\u6848" tabindex="-1"><a class="header-anchor" href="#\u90E8\u7F72\u65B9\u6848" aria-hidden="true">#</a> \u90E8\u7F72\u65B9\u6848</h3><blockquote><p>\u76EE\u6807\u662F\u90E8\u7F72 3 \u4E2A\u5B9E\u4F8B\uFF0C\u4E00\u822C 3 \u4E2A\u662F\u6BD4\u8F83\u7A33\u5B9A\u7684\u6570\u636E\uFF0C\u6BD4\u8F83\u4E0D\u5BB9\u6613\u51FA\u95EE\u9898\uFF0C\u5B9E\u9645\u4E2D\u9700\u8981\u6839\u636E\u81EA\u5DF1\u7684\u4E1A\u52A1\u6765\u5224\u65AD\u3002</p><p>\u4E5F\u5C31\u662F\u8BF4\uFF0C\u9700\u8981\u4E00\u4E2A<code>Service</code>\uFF0C\u4E00\u4E2A<code>Deployment</code>\uFF0C\u8FD9\u4E2A<code>Deployment</code>\u7BA1\u7740 3 \u4E2A<code>Pod</code>\uFF0C\u6BCF\u4E2A<code>Pod</code>\u662F\u4E00\u4E2A\u5B9E\u4F8B\u3002</p></blockquote>`,9),h=s(`<h3 id="\u51C6\u5907k8s\u5BB9\u5668\u955C\u50CF" tabindex="-1"><a class="header-anchor" href="#\u51C6\u5907k8s\u5BB9\u5668\u955C\u50CF" aria-hidden="true">#</a> \u51C6\u5907K8S\u5BB9\u5668\u955C\u50CF</h3><ul><li>\u5DF2\u77E5\uFF1AK8S \u8C03\u5EA6\u7684\u662F\u5BB9\u5668</li><li>\u5DF2\u77E5\uFF1A\u5BB9\u5668\u91CC\u8FD0\u884C\u7684\u662F\u5404\u79CD\u955C\u50CF</li><li>\u53C8\u77E5\uFF1A\u6211\u4EEC\u8981\u5728 K8S \u91CC\u8FD0\u884C xxx</li></ul><p><strong>\u5373\uFF1A\u6211\u4EEC\u8981\u628A<code>xxx</code>\u5E94\u7528\u6253\u5305\u6210\u955C\u50CF</strong></p><h4 id="\u9996\u5148\u5728\u672C\u5730\u5B8C\u6210\u7F16\u8BD1" tabindex="-1"><a class="header-anchor" href="#\u9996\u5148\u5728\u672C\u5730\u5B8C\u6210\u7F16\u8BD1" aria-hidden="true">#</a> \u9996\u5148\u5728\u672C\u5730\u5B8C\u6210\u7F16\u8BD1</h4><p>\u5FC5\u987B\u751F\u6210\u4E00\u4E2A\u53EF\u5728<code>linux</code>\u5E73\u53F0\u53EF\u6267\u884C\u7684<code>xxx</code>\u53EF\u6267\u884C\u7684\u6587\u4EF6</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># \u5FC5\u987B\u8FDB\u5165\u5230\u5BF9\u5E94\u7684\u76EE\u5F55\u91CC\u6267\u884C</span>
<span class="token assign-left variable">GOOS</span><span class="token operator">=</span>linux <span class="token assign-left variable">GOARCH</span><span class="token operator">=</span>arm go build -o xxx <span class="token builtin class-name">.</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>\u6267\u884C\u4E00\u4E2A<code>Docker</code>\u547D\u4EE4\u6253\u5305\u6210\u4E00\u4E2A\u955C\u50CF\uFF0C\u8FD8\u9700\u8981\u51C6\u5907\u4E00\u4E2A<code>Dockerfile</code></p><div class="language-Dockerfile ext-Dockerfile line-numbers-mode"><pre class="language-Dockerfile"><code># \u6307\u5B9A\u57FA\u7840\u955C\u50CF
FROM ubuntu:20.04

# copy \u4E8C\u8FDB\u5236\u6587\u4EF6
COPY webook /app/webook

# \u8BBE\u7F6E\u5DE5\u4F5C\u76EE\u5F55
WORKDIR /app

# \u6267\u884C\u4E8C\u8FDB\u5236\u6587\u4EF6
ENTRYPOINT [&quot;/app/webook&quot;]
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">docker</span> build -t wxvirus/webook:v0.0.1 <span class="token builtin class-name">.</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">docker</span> images <span class="token operator">|</span> <span class="token function">grep</span> webook            
wxvirus/webook                     v0.0.1    1944c883ad2f   <span class="token number">29</span> seconds ago   <span class="token number">75</span>.9MB

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5C01\u88C5\u4E00\u4E2A<code>make docker</code>\u547D\u4EE4</p><div class="language-makefile ext-makefile line-numbers-mode"><pre class="language-makefile"><code><span class="token builtin-target builtin">.PHONY</span><span class="token punctuation">:</span> docker
<span class="token target symbol">docker</span><span class="token punctuation">:</span>
	<span class="token operator">@</span>rm webook <span class="token operator">|</span><span class="token operator">|</span> true
	<span class="token operator">@</span>GOOS<span class="token operator">=</span>linux GOARCH<span class="token operator">=</span>arm go build -o webook .
<span class="token target symbol">	@docker rmi -f wxvirus/webook</span><span class="token punctuation">:</span>v0.0.1
<span class="token target symbol">	@docker build -t wxvirus/webook</span><span class="token punctuation">:</span>v0.0.1 .
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># \u6267\u884C\u547D\u4EE4 \u4E00\u6B65\u5230\u4F4D</span>
<span class="token function">make</span> <span class="token function">docker</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5982\u679C\u662F<code>windows</code>\u7684\uFF0C\u53EF\u4EE5\u5199\u4E00\u4E2A<code>.sh</code>\u4E00\u6837\u6267\u884C\u5373\u53EF\u3002</p><h2 id="\u7F16\u5199-deployment" tabindex="-1"><a class="header-anchor" href="#\u7F16\u5199-deployment" aria-hidden="true">#</a> \u7F16\u5199 Deployment</h2><p>\u7F16\u5199\u7B2C\u4E00\u4E2A<code>K8S</code>\u7684\u914D\u7F6E\u6587\u4EF6</p>`,16),g=e("\u53C2\u8003\u6587\u6863: "),y={href:"https://kubernetes.io/docs/concepts/workloads/controllers/deployment/",target:"_blank",rel:"noopener noreferrer"},f=e("https://kubernetes.io/docs/concepts/workloads/controllers/deployment/"),x=s(`<p><code>k8s-webook-deployment.yaml</code></p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Deployment
<span class="token comment"># \u5143\u6570\u636E</span>
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token comment"># \u540D\u79F0</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> webook
<span class="token comment"># \u89C4\u683C\u8BF4\u660E\uFF0C\u90E8\u7F72\u7684\u4EC0\u4E48</span>
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token comment"># \u526F\u672C\u6570\u91CF\uFF0C\u5373\u8BA9\u5B83\u90E8\u7F72 3 \u4E2A\u5B9E\u4F8B</span>
  <span class="token key atrule">replicas</span><span class="token punctuation">:</span> <span class="token number">3</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span>
      <span class="token key atrule">app</span><span class="token punctuation">:</span> webook
  <span class="token comment"># \u63CF\u8FF0\u7684\u662F\u4F60\u7684 pod \u662F\u4EC0\u4E48\u6837\u7684</span>
  <span class="token key atrule">template</span><span class="token punctuation">:</span>
    <span class="token key atrule">metadata</span><span class="token punctuation">:</span>
      <span class="token key atrule">labels</span><span class="token punctuation">:</span>
        <span class="token comment"># \u8981\u548C\u4E0A\u9762\u7684\u5B8C\u5168\u914D\u7684\u4E0A\uFF0CKS8 \u90FD\u662F\u6309\u7167\u6807\u7B7E\u5BFB\u627E\u7684</span>
        <span class="token key atrule">app</span><span class="token punctuation">:</span> webook
    <span class="token comment"># POD \u5F97\u5177\u4F53\u4FE1\u606F</span>
    <span class="token key atrule">spec</span><span class="token punctuation">:</span>
      <span class="token key atrule">containers</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> webook
          <span class="token key atrule">image</span><span class="token punctuation">:</span> wxvirus/webook<span class="token punctuation">:</span>v0.0.1
          <span class="token key atrule">ports</span><span class="token punctuation">:</span>
            <span class="token comment"># \u5BF9\u5E94\u7684\u4F60\u7684 webook \u542F\u52A8\u7684\u7AEF\u53E3</span>
            <span class="token punctuation">-</span> <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">9093</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="custom-container danger"><p class="custom-container-title">\u6CE8\u610F</p><p><code>app: webook</code>\u5BF9\u5E94\u7684\u5E94\u7528\u540D\u79F0\u57FA\u672C\u90FD\u4FDD\u6301\u4E00\u81F4</p></div><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>kubectl apply -f k8s-webook-deployment.yaml
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>\u6709\u63D0\u793A: <code>deployment.apps/webook created</code>\u5373\u53EF\u3002</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>kubectl get deployments                    
NAME      READY   UP-TO-DATE   AVAILABLE   AGE
webook    <span class="token number">3</span>/3     <span class="token number">3</span>            <span class="token number">3</span>           35s
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>kubectl get pods <span class="token operator">|</span> <span class="token function">grep</span> webook
webook-5bc7f45d66-qp69t    <span class="token number">1</span>/1     Running   <span class="token number">0</span>          30s
webook-5bc7f45d66-jt2q7    <span class="token number">1</span>/1     Running   <span class="token number">0</span>          29s
webook-5bc7f45d66-64drd    <span class="token number">1</span>/1     Running   <span class="token number">0</span>          28s
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h3 id="apiversion" tabindex="-1"><a class="header-anchor" href="#apiversion" aria-hidden="true">#</a> <code>apiVersion</code></h3><p><code>K8S</code>\u7B80\u5355\u7406\u89E3\u5C31\u662F\u4E00\u4E2A\u914D\u7F6E\u9A71\u52A8\u7684\uFF0C\u6216\u8005\u5143\u6570\u636E\u9A71\u52A8\uFF0C\u6211\u4EEC\u7528\u6237\u8D1F\u8D23\u63D0\u4F9B\u5404\u79CD\u914D\u7F6E\uFF0C\u7136\u540E<code>K8S</code>\u6839\u636E\u914D\u7F6E\u6765\u6267\u884C\u4E00\u4E9B\u52A8\u4F5C\uFF0C\u5C31\u662F\u4F7F\u7528<code>apiVersion</code>\u6765\u786E\u5B9A\u5982\u4F55\u89E3\u8BFB\u914D\u7F6E\u3002</p><blockquote><p>\u53EF\u4EE5\u5145\u5206\u5229\u7528\u7F16\u8F91\u5668\u7684\u63D0\u793A\u6765\u786E\u5B9A\u4F7F\u7528\u54EA\u4E2A<code>apiVersion</code>\uFF0C\u81EA\u52A8\u5E2E\u4F60\u7EA0\u6B63\u3002</p></blockquote><h3 id="spec" tabindex="-1"><a class="header-anchor" href="#spec" aria-hidden="true">#</a> spec</h3><p><code>Deployment</code>\u7684\u89C4\u683C\u8BF4\u660E\uFF0C\u89C4\u683C\u8BF4\u660E\u7406\u89E3\u4E3A\u8BF4\u660E\u4E66</p><ul><li><code>replicas</code>: \u503C\u4E3A 3\uFF0C\u610F\u601D\u662F\u8FD9\u4E2A<code>Deployment</code>\u91CC\u9762\u6709 3 \u4E2A\u526F\u672C\uFF0C\u5B9E\u9645\u4E0A\u5C31\u662F 3 \u4E2A<code>Pod</code></li><li><code>selector</code>: \u7B5B\u9009\u5668\uFF0C\u5728<code>K8S</code>\u91CC\u4E00\u5927\u5806<code>Pod</code>\u91CC\u9762\u77E5\u9053\u7BA1\u7406\u7684\u662F\u54EA3 \u4E2A\uFF0C\u6807\u7B7E\u7684<code>key</code>\u4E3A<code>app</code>\uFF0C\u503C\u53EB<code>webook</code>\u7684</li><li><code>template</code>: \u6BCF\u4E2A<code>Pod</code>\u957F\u4EC0\u4E48\u6837\uFF0C\u5C31\u662F\u6A21\u677F\uFF0C\u76F4\u63A5\u6309\u7167\u6A21\u677F\u521B\u5EFA</li></ul><h3 id="selector" tabindex="-1"><a class="header-anchor" href="#selector" aria-hidden="true">#</a> selector</h3><p>\u7B5B\u9009 K8S \u6240\u9700\u8D44\u6E90\u3002\u914D\u7F6E\u4E2D\u4F7F\u7528\u7684\u662F<code>machLabels</code>\uFF0C\u4E5F\u5C31\u662F\u8BF4<code>Deployment</code>\u6309\u7167\u6807\u7B7E<code>label</code>\u6765\u7B5B\u9009\u5B83\u9700\u8981\u7684\u8D44\u6E90--<code>Pod</code>\u3002</p><p><strong>\u5B83\u9700\u8981\u7684\u662F\u542B\u6709<code>app=webook</code>\u8FD9\u4E2A\u6807\u7B7E\u7684<code>Pod</code></strong></p><p>\u8FD8\u6709<code>matchExpressions</code>,\u5373\u6839\u636E\u8868\u8FBE\u5F0F\u6765\u7B5B\u9009\u3002</p><h3 id="template" tabindex="-1"><a class="header-anchor" href="#template" aria-hidden="true">#</a> template</h3><p>\u5728<code>kind</code>\u4E0D\u540C\u7684\u65F6\u5019\u5BF9\u5E94\u7684\u5185\u5BB9\u4E5F\u4E0D\u540C\uFF0C\u5728<code>Deployment</code>\u91CC\u9762\u662F\u521B\u5EFA\u7684<code>Pod</code>\u7684\u6A21\u677F\uFF0C\u800C<code>template</code>\u7684<code>spec</code>\u5F97\u91CC\u9762\u8981\u6307\u5B9A<code>containers</code>\uFF0C\u5C31\u53EF\u4EE5\u770B\u7684\u51FA\u6765<code>Pod</code>\u91CC\u9762\u8DD1\u7684\u5C31\u662F\u5BB9\u5668\uFF0C\u800C\u4E14\u53EF\u4EE5\u8DD1\u591A\u4E2A\u5BB9\u5668\u3002</p><h3 id="image" tabindex="-1"><a class="header-anchor" href="#image" aria-hidden="true">#</a> image</h3><p><code>image</code>\u5C31\u662F\u955C\u50CF\uFF0C\u6211\u4EEC\u8FD9\u91CC\u7528\u7684\u662F<code>docker</code>\u6784\u5EFA\u7684\u955C\u50CF</p><div class="custom-container tip"><p class="custom-container-title">\u6CE8\u610F</p><p><code>Docker</code>\u662F\u5B9E\u73B0<code>OCI</code>\u6807\u51C6\u7684\uFF0C\u6240\u4EE5\u5373\u4FBF\u73B0\u5728<code>K8s</code>\u58F0\u79F0\u4E0D\u652F\u6301<code>Docker</code>\uFF0C\u4F46\u8FD9\u4E2A\u955C\u50CF\u4F9D\u65E7\u53EF\u4EE5\u4F7F\u7528\u3002</p></div><h2 id="\u7F16\u5199-service" tabindex="-1"><a class="header-anchor" href="#\u7F16\u5199-service" aria-hidden="true">#</a> \u7F16\u5199 Service</h2><p>\u6B64\u65F6<code>Deployment</code>\u662F\u6CA1\u6709\u529E\u6CD5\u4ECE\u5916\u9762\u8BBF\u95EE\u7684\uFF0C\u6211\u4EEC\u9700\u8981\u5C06<code>Pod</code>\u5C01\u88C5\u4E3A\u4E00\u4E2A\u903B\u8F91\u4E0A\u7684\u670D\u52A1\uFF0C\u5373<code>Service</code>\u3002</p><p><code>spec</code>\u91CC\u6709 2 \u4E2A\u5B57\u6BB5\u8981\u6CE8\u610F\uFF1A</p><ul><li><code>type</code>\uFF1A\u8FD9\u91CC\u9009\u62E9\u7684\u662F<code>LoadBalancer</code>\uFF0C\u8D1F\u8F7D\u5747\u8861\uFF0C\u610F\u601D\u662F\u8FD9\u4E2A<code>Service</code>\u5728\u903B\u8F91\u4E0A\u8FD8\u8981\u8D1F\u8D23\u8D1F\u8F7D\u5747\u8861\u7684\u95EE\u9898 <ul><li>\u7ED9<code>selector</code>\u91CC\u7B5B\u9009\u51FA\u6765\u7684<code>Pod</code>\u505A\u8D1F\u8F7D\u5747\u8861</li></ul></li><li><code>ports</code>\uFF1A\u7AEF\u53E3\uFF0C\u53EF\u4EE5\u914D\u7F6E\u591A\u4E2A\uFF0C\u8FD8\u53EF\u4EE5\u989D\u5916\u914D\u7F6E\u4E00\u4E2A<code>HTTPS</code>\u7684 <ul><li><code>name</code>\uFF1A\u7AEF\u53E3\u7684\u540D\u5B57\uFF0C\u4E00\u822C\u7528\u6765\u6307\u793A\u7528\u9014\uFF0C\u6BD4\u5982<code>http</code>\u610F\u601D\u5C31\u662F\u7528\u6765\u63A5\u6536<code>HTTP</code>\u8BF7\u6C42\uFF0C\u53EF\u4EE5\u968F\u4FBF\u5199</li><li><code>port</code>\uFF1A\u5916\u90E8\u8BBF\u95EE\u7684\u7AEF\u53E3</li><li><code>protocol</code>\uFF1A\u8FD9\u4E2A\u7AEF\u53E3\u76D1\u542C\u4EC0\u4E48\u534F\u8BAE</li><li><code>targetPort</code>\uFF1A\u8F6C\u53D1\u8BF7\u6C42\u7684\u65F6\u5019\uFF0C\u5E94\u8BE5\u8F6C\u53D1\u5230\u54EA\u4E2A<code>Pod</code>\u4E0A\u7684\u54EA\u4E2A\u7AEF\u53E3</li></ul></li></ul><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Service
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> webook
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token comment"># \u7B5B\u9009\u7684\u662F deployment \u91CC\u5B9A\u4E49\u7684 pod \u7684\u6807\u7B7E</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> webook
  <span class="token key atrule">ports</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">protocol</span><span class="token punctuation">:</span> TCP
      <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8081</span>
      <span class="token key atrule">targetPort</span><span class="token punctuation">:</span> <span class="token number">9093</span>
  <span class="token comment"># \u5F53\u6210\u662F\u4E00\u4E2A\u8D1F\u8F7D\u5747\u8861\u5668</span>
  <span class="token key atrule">type</span><span class="token punctuation">:</span> LoadBalancer
  
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>\u6CE8\u610F\uFF0C\u8FD9\u91CC\u6211\u7684<code>80</code>\u7AEF\u53E3\u6539\u6210\u4E86<code>8081</code>\uFF0C\u56E0\u4E3A\u6211\u672C\u5730<code>80</code>\u7AEF\u53E3\u5DF2\u7ECF\u88AB\u5360\u7528\u4E86\uFF0C\u6240\u4EE5\u6362\u4E86\u4E00\u4E2A\uFF0C\u5BF9\u5E94\u7684<code>targetPort</code>\u4E5F\u8981\u6362\u6210\u548C<code>Pod</code>\u5B9E\u4F8B\u91CC\u9762<code>web</code>\u670D\u52A1\u7684\u7AEF\u53E3\u4E00\u81F4\u3002</p></blockquote><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>kubectl apply -f k8s-webook-service.yaml   
service/webook created
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>kubectl get services                    
NAME         TYPE           CLUSTER-IP        EXTERNAL-IP    PORT<span class="token punctuation">(</span>S<span class="token punctuation">)</span>                      AGE
webook       LoadBalancer   <span class="token number">192.168</span>.194.248   <span class="token operator">&lt;</span>pending<span class="token operator">&gt;</span>      <span class="token number">80</span>:30038/TCP                 16s

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>\u6CE8\u610F\uFF0C\u6211\u8FD9\u91CC\u663E\u793A\u4E86<code>&lt;pending&gt;</code>\u5C31\u662F\u56E0\u4E3A\u4E0A\u9762\u5199\u7684\u7AEF\u53E3\u662F<code>80</code>\u5BFC\u81F4\u5360\u7528\u7684\uFF0C\u6539\u4E86\u4E4B\u540E\u5C31\u884C\u4E86\u3002</p></blockquote>`,32);function w(_,P){const o=c("ExternalLinkIcon"),i=c("Mermaid");return l(),t("div",null,[r,n("p",null,[u,n("a",k,[v,a(o)]),m]),b,a(i,{id:"mermaid-382ee1e8",code:"flowchart%20LR%3B%0Aid1%5BUser%5D%0Aid2%5Bxxx-service%5D%0Aid3%5BPod%200%5D%0Aid4%5BPod%201%5D%0Aid5%5BPod%202%5D%0Aid1%20-.%20%2Fhello%20.-%3E%20id2%0Aid2%20-.%20%2Fhello%20.-%3E%20id3%0Aid2%20-.%20%2Fhello%20.-%3E%20id4%0Aid2%20-.%20%2Fhello%20.-%3E%20id5%0A%0A"}),h,n("p",null,[g,n("a",y,[f,a(o)])]),x])}var A=d(p,[["render",w],["__file","k8s-apply.html.vue"]]);export{A as default};
