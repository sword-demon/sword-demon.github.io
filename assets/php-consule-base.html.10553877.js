import{_ as e}from"./plugin-vue_export-helper.21dcd24c.js";import{r as o,o as c,c as l,a as n,b as t,d as s,e as p}from"./app.38d4aac1.js";const i={},u=n("h1",{id:"consul-\u7684-php-\u7684\u670D\u52A1\u6CE8\u518C\u4E0E\u53D1\u73B0",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#consul-\u7684-php-\u7684\u670D\u52A1\u6CE8\u518C\u4E0E\u53D1\u73B0","aria-hidden":"true"},"#"),s(" Consul \u7684 PHP \u7684\u670D\u52A1\u6CE8\u518C\u4E0E\u53D1\u73B0")],-1),r=n("h2",{id:"\u4E0B\u8F7D\u5B89\u88C5",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#\u4E0B\u8F7D\u5B89\u88C5","aria-hidden":"true"},"#"),s(" \u4E0B\u8F7D\u5B89\u88C5")],-1),k=s("\u4E0B\u8F7D\u5730\u5740\uFF1A"),d={href:"https://developer.hashicorp.com/consul/downloads",target:"_blank",rel:"noopener noreferrer"},v=s("https://developer.hashicorp.com/consul/downloads"),m=p(`<h2 id="\u670D\u52A1\u6CE8\u518C\u548C\u670D\u52A1\u53D1\u73B0" tabindex="-1"><a class="header-anchor" href="#\u670D\u52A1\u6CE8\u518C\u548C\u670D\u52A1\u53D1\u73B0" aria-hidden="true">#</a> \u670D\u52A1\u6CE8\u518C\u548C\u670D\u52A1\u53D1\u73B0</h2><ul><li>\u670D\u52A1\u6CE8\u518C<code>consul</code>\u7684\u63A5\u53E3\u5730\u5740\uFF1A<code>agent/service/register</code></li><li>\u670D\u52A1\u53D1\u73B0<code>consul</code>\u7684\u63A5\u53E3\u5730\u5740\uFF1A<code>health/service/{serviceId}</code></li></ul><blockquote><p>\u7B80\u5355\u4F7F\u7528<code>ThinkPHP6.0</code>\u6765\u5B9E\u73B0\u670D\u52A1\u6CE8\u518C\u548C\u670D\u52A1\u53D1\u73B0</p></blockquote><p>\u5148\u914D\u7F6E<code>consul</code>\u7684\u4E00\u4E9B\u5185\u5BB9</p><div class="language-php ext-php line-numbers-mode"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">return</span> <span class="token punctuation">[</span>
    <span class="token string single-quoted-string">&#39;consul&#39;</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>
        <span class="token string single-quoted-string">&#39;host&#39;</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">&#39;localhost&#39;</span><span class="token punctuation">,</span>
        <span class="token string single-quoted-string">&#39;port&#39;</span> <span class="token operator">=&gt;</span> <span class="token number">8500</span> <span class="token comment">// web ui \u7684\u7AEF\u53E3\u5730\u5740</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
</span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u63A5\u7740\u6211\u4EEC\u5728\u4E00\u4E2A<code>service</code>\u76EE\u5F55\u4E0B\u65B0\u5EFA<code>Consul</code>\u670D\u52A1\u7C7B</p><div class="language-php ext-php line-numbers-mode"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>


<span class="token keyword">namespace</span> <span class="token package">app<span class="token punctuation">\\</span>service</span><span class="token punctuation">;</span>


<span class="token keyword">use</span> <span class="token package">think<span class="token punctuation">\\</span>facade<span class="token punctuation">\\</span>Config</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name-definition class-name">Consul</span>
<span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token variable">$httpUrl</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$consulConfig</span> <span class="token operator">=</span> <span class="token class-name static-context">Config</span><span class="token operator">::</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;common.consul&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">httpUrl</span> <span class="token operator">=</span><span class="token string single-quoted-string">&#39;http://&#39;</span><span class="token operator">.</span><span class="token variable">$consulConfig</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&#39;host&#39;</span><span class="token punctuation">]</span><span class="token operator">.</span><span class="token string single-quoted-string">&#39;:&#39;</span><span class="token operator">.</span><span class="token variable">$consulConfig</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&#39;port&#39;</span><span class="token punctuation">]</span> <span class="token operator">.</span> <span class="token string single-quoted-string">&#39;/&#39;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// \u670D\u52A1\u6CE8\u518C</span>
    <span class="token comment">// agent/service/register</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">registerService</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$url</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">httpUrl</span> <span class="token operator">.</span> <span class="token string single-quoted-string">&#39;v1/agent/service/register&#39;</span><span class="token punctuation">;</span>
        <span class="token comment">// \u8BF7\u6C42\u8FD9\u4E2A\u63A5\u53E3</span>
        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">curlPUT</span><span class="token punctuation">(</span><span class="token variable">$url</span><span class="token punctuation">,</span> <span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// \u670D\u52A1\u4FE1\u606F</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">serviceInfo</span><span class="token punctuation">(</span><span class="token variable">$serviceId</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token variable">$url</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">httpUrl</span> <span class="token operator">.</span> <span class="token string single-quoted-string">&#39;v1/health/service/&#39;</span><span class="token operator">.</span><span class="token variable">$serviceId</span><span class="token punctuation">;</span>
        <span class="token variable">$res</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">curlGET</span><span class="token punctuation">(</span><span class="token variable">$url</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">echo</span> <span class="token variable">$res</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">curlPUT</span><span class="token punctuation">(</span><span class="token variable">$httpUrl</span><span class="token punctuation">,</span> <span class="token variable">$data</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$ch</span> <span class="token operator">=</span> <span class="token function">curl_init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">curl_setopt</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">,</span> <span class="token constant">CURLOPT_URL</span><span class="token punctuation">,</span> <span class="token variable">$httpUrl</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">curl_setopt</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">,</span> <span class="token constant">CURLOPT_CUSTOMREQUEST</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">&quot;PUT&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">curl_setopt</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">,</span> <span class="token constant">CURLOPT_HEADER</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">curl_setopt</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">,</span> <span class="token constant">CURLOPT_HTTPHEADER</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string single-quoted-string">&#39;Content-Type:application/json&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">curl_setopt</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">,</span> <span class="token constant">CURLOPT_RETURNTRANSFER</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">curl_setopt</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">,</span> <span class="token constant">CURLOPT_POSTFIELDS</span><span class="token punctuation">,</span> <span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$res</span> <span class="token operator">=</span> <span class="token function">curl_exec</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$res</span> <span class="token operator">===</span> <span class="token constant boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token function">curl_errno</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token function">curl_close</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token variable">$res</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">curlGET</span><span class="token punctuation">(</span><span class="token variable">$httpUrl</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$ch</span> <span class="token operator">=</span> <span class="token function">curl_init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">curl_setopt</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">,</span> <span class="token constant">CURLOPT_URL</span><span class="token punctuation">,</span> <span class="token variable">$httpUrl</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">curl_setopt</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">,</span> <span class="token constant">CURLOPT_CUSTOMREQUEST</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">&quot;GET&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">curl_setopt</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">,</span> <span class="token constant">CURLOPT_HEADER</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">curl_setopt</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">,</span> <span class="token constant">CURLOPT_HTTPHEADER</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string single-quoted-string">&#39;Content-Type:application/json&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">curl_setopt</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">,</span> <span class="token constant">CURLOPT_RETURNTRANSFER</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$res</span> <span class="token operator">=</span> <span class="token function">curl_exec</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$res</span> <span class="token operator">===</span> <span class="token constant boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token function">curl_errno</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token function">curl_close</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token variable">$res</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u7F16\u5199\u4E00\u4E2A\u63A7\u5236\u5668\u6765\u8FDB\u884C\u6D4B\u8BD5</p><div class="language-php ext-php line-numbers-mode"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>


<span class="token keyword">namespace</span> <span class="token package">app<span class="token punctuation">\\</span>controller</span><span class="token punctuation">;</span>


<span class="token keyword">use</span> <span class="token package">app<span class="token punctuation">\\</span>BaseController</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">app<span class="token punctuation">\\</span>service<span class="token punctuation">\\</span>Consul</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name-definition class-name">ConsulDemo</span> <span class="token keyword">extends</span> <span class="token class-name">BaseController</span>
<span class="token punctuation">{</span>
    <span class="token comment">// \u6CE8\u518C\u670D\u52A1</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">registerDemo</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$data</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
            <span class="token comment">// \u670D\u52A1id</span>
            <span class="token string single-quoted-string">&#39;ID&#39;</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">&#39;demoService&#39;</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">&#39;Name&#39;</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">&#39;demoService&#39;</span><span class="token punctuation">,</span> <span class="token comment">// \u670D\u52A1\u540D\u79F0</span>
            <span class="token string single-quoted-string">&#39;Tags&#39;</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span><span class="token string single-quoted-string">&#39;core.demo&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">&#39;Address&#39;</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">&#39;192.168.0.101&#39;</span><span class="token punctuation">,</span> <span class="token comment">// \u672C\u673A\u7684ip</span>
            <span class="token string single-quoted-string">&#39;Port&#39;</span> <span class="token operator">=&gt;</span> <span class="token number">8087</span><span class="token punctuation">,</span>
            <span class="token comment">// \u5065\u5EB7\u68C0\u67E5\u56DE\u8C03\u5730\u5740</span>
            <span class="token string single-quoted-string">&#39;Check&#39;</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>
                <span class="token string single-quoted-string">&#39;HTTP&#39;</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">&#39;http://192.168.0.101:8087&#39;</span><span class="token punctuation">,</span>
                <span class="token string single-quoted-string">&#39;Interval&#39;</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">&#39;5s&#39;</span>
            <span class="token punctuation">]</span>
        <span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token variable">$consul</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Consul</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$rs</span> <span class="token operator">=</span> <span class="token variable">$consul</span><span class="token operator">-&gt;</span><span class="token function">registerService</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token variable">$rs</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// \u670D\u52A1\u53D1\u73B0</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">serviceInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$serviceId</span> <span class="token operator">=</span> <span class="token string single-quoted-string">&#39;demoService&#39;</span><span class="token punctuation">;</span>
        <span class="token variable">$consul</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Consul</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$rs</span> <span class="token operator">=</span> <span class="token variable">$consul</span><span class="token operator">-&gt;</span><span class="token function">serviceInfo</span><span class="token punctuation">(</span><span class="token variable">$serviceId</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token variable">$rs</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u914D\u7F6E<code>tp</code>\u7684\u8DEF\u7531</p><div class="language-php ext-php line-numbers-mode"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token keyword">use</span> <span class="token package">think<span class="token punctuation">\\</span>facade<span class="token punctuation">\\</span>Route</span><span class="token punctuation">;</span>


<span class="token comment">// Consul</span>
<span class="token class-name static-context">Route</span><span class="token operator">::</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;consul/reg/demo&#39;</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">&#39;ConsulDemo/registerDemo&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name static-context">Route</span><span class="token operator">::</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;consul/service/info&#39;</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">&#39;ConsulDemo/serviceInfo&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="\u6D4B\u8BD5" tabindex="-1"><a class="header-anchor" href="#\u6D4B\u8BD5" aria-hidden="true">#</a> \u6D4B\u8BD5</h2><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>consul agent -dev
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>\u4F7F\u7528\u4E0A\u9762\u7684\u547D\u4EE4\u6765\u672C\u5730\u5F00\u53D1\u8FD0\u884C<code>consul</code>\uFF0C\u7136\u540E\u5230\u6D4F\u89C8\u5668\u8F93\u5165<code>localhost:8500</code>\u5373\u53EF\u8BBF\u95EE\u5BF9\u5E94\u7684<code>web ui</code>\u9875\u9762\u3002</p><p>\u518D\u542F\u52A8<code>ThinkPHP</code>\u52A0\u4E0A\u4E0A\u9762\u4EE3\u7801\u91CC\u8BBE\u7F6E\u7684\u5BF9\u5E94\u7684\u7AEF\u53E3\u8FD0\u884C</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>php think run -p8087
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><img src="https://virusoss.oss-cn-shanghai.aliyuncs.com/images/image-20221220220151138.png" alt="image-20221220220151138" loading="lazy"></p><p>\u6211\u4EEC\u4F9D\u6B21\u5728\u6D4F\u89C8\u5668\u8BBF\u95EE\u63A7\u5236\u5668\u91CC\u7684\u63A5\u53E3</p>`,18),b={href:"http://127.0.0.1:8087/consul/service/info",target:"_blank",rel:"noopener noreferrer"},q=s("http://127.0.0.1:8087/consul/service/info"),g=p(`<p>\u8FD9\u4E2A\u8BBF\u95EE\uFF0C\u4F7F\u7528<code>json</code>\u65B9\u5F0F\u67E5\u770B\u5185\u5BB9</p><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
        <span class="token property">&quot;Node&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">&quot;ID&quot;</span><span class="token operator">:</span> <span class="token string">&quot;cef7b229-831c-c1b4-9f71-81a7f9035b80&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;Node&quot;</span><span class="token operator">:</span> <span class="token string">&quot;wujie&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;Address&quot;</span><span class="token operator">:</span> <span class="token string">&quot;127.0.0.1&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;Datacenter&quot;</span><span class="token operator">:</span> <span class="token string">&quot;dc1&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;TaggedAddresses&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token property">&quot;lan&quot;</span><span class="token operator">:</span> <span class="token string">&quot;127.0.0.1&quot;</span><span class="token punctuation">,</span>
                <span class="token property">&quot;lan_ipv4&quot;</span><span class="token operator">:</span> <span class="token string">&quot;127.0.0.1&quot;</span><span class="token punctuation">,</span>
                <span class="token property">&quot;wan&quot;</span><span class="token operator">:</span> <span class="token string">&quot;127.0.0.1&quot;</span><span class="token punctuation">,</span>
                <span class="token property">&quot;wan_ipv4&quot;</span><span class="token operator">:</span> <span class="token string">&quot;127.0.0.1&quot;</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token property">&quot;Meta&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token property">&quot;consul-network-segment&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token property">&quot;CreateIndex&quot;</span><span class="token operator">:</span> <span class="token number">13</span><span class="token punctuation">,</span>
            <span class="token property">&quot;ModifyIndex&quot;</span><span class="token operator">:</span> <span class="token number">14</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token property">&quot;Service&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">&quot;ID&quot;</span><span class="token operator">:</span> <span class="token string">&quot;demoService&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;Service&quot;</span><span class="token operator">:</span> <span class="token string">&quot;demoService&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;Tags&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;core.demo&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token property">&quot;Address&quot;</span><span class="token operator">:</span> <span class="token string">&quot;192.168.0.101&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;TaggedAddresses&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token property">&quot;lan_ipv4&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                    <span class="token property">&quot;Address&quot;</span><span class="token operator">:</span> <span class="token string">&quot;192.168.0.101&quot;</span><span class="token punctuation">,</span>
                    <span class="token property">&quot;Port&quot;</span><span class="token operator">:</span> <span class="token number">8087</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token property">&quot;wan_ipv4&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                    <span class="token property">&quot;Address&quot;</span><span class="token operator">:</span> <span class="token string">&quot;192.168.0.101&quot;</span><span class="token punctuation">,</span>
                    <span class="token property">&quot;Port&quot;</span><span class="token operator">:</span> <span class="token number">8087</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token property">&quot;Meta&quot;</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
            <span class="token property">&quot;Port&quot;</span><span class="token operator">:</span> <span class="token number">8087</span><span class="token punctuation">,</span>
            <span class="token property">&quot;Weights&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token property">&quot;Passing&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
                <span class="token property">&quot;Warning&quot;</span><span class="token operator">:</span> <span class="token number">1</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token property">&quot;EnableTagOverride&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
            <span class="token property">&quot;Proxy&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token property">&quot;Mode&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
                <span class="token property">&quot;MeshGateway&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token property">&quot;Expose&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token property">&quot;Connect&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token property">&quot;PeerName&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;CreateIndex&quot;</span><span class="token operator">:</span> <span class="token number">30</span><span class="token punctuation">,</span>
            <span class="token property">&quot;ModifyIndex&quot;</span><span class="token operator">:</span> <span class="token number">30</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token property">&quot;Checks&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{</span>
                <span class="token property">&quot;Node&quot;</span><span class="token operator">:</span> <span class="token string">&quot;wujie&quot;</span><span class="token punctuation">,</span>
                <span class="token property">&quot;CheckID&quot;</span><span class="token operator">:</span> <span class="token string">&quot;serfHealth&quot;</span><span class="token punctuation">,</span>
                <span class="token property">&quot;Name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Serf Health Status&quot;</span><span class="token punctuation">,</span>
                <span class="token property">&quot;Status&quot;</span><span class="token operator">:</span> <span class="token string">&quot;passing&quot;</span><span class="token punctuation">,</span>
                <span class="token property">&quot;Notes&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
                <span class="token property">&quot;Output&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Agent alive and reachable&quot;</span><span class="token punctuation">,</span>
                <span class="token property">&quot;ServiceID&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
                <span class="token property">&quot;ServiceName&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
                <span class="token property">&quot;ServiceTags&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token property">&quot;Type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
                <span class="token property">&quot;Interval&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
                <span class="token property">&quot;Timeout&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
                <span class="token property">&quot;ExposedPort&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
                <span class="token property">&quot;Definition&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token property">&quot;CreateIndex&quot;</span><span class="token operator">:</span> <span class="token number">13</span><span class="token punctuation">,</span>
                <span class="token property">&quot;ModifyIndex&quot;</span><span class="token operator">:</span> <span class="token number">13</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>
                <span class="token property">&quot;Node&quot;</span><span class="token operator">:</span> <span class="token string">&quot;wujie&quot;</span><span class="token punctuation">,</span>
                <span class="token property">&quot;CheckID&quot;</span><span class="token operator">:</span> <span class="token string">&quot;service:demoService&quot;</span><span class="token punctuation">,</span>
                <span class="token property">&quot;Name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Service &#39;demoService&#39; check&quot;</span><span class="token punctuation">,</span>
                <span class="token property">&quot;Status&quot;</span><span class="token operator">:</span> <span class="token string">&quot;passing&quot;</span><span class="token punctuation">,</span>
                <span class="token property">&quot;Notes&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
                <span class="token property">&quot;Output&quot;</span><span class="token operator">:</span> <span class="token string">&quot;HTTP GET http://192.168.0.101:8087: 200 OK Output: &lt;style type=\\&quot;text/css\\&quot;&gt;*{ padding: 0; margin: 0; } div{ padding: 4px 48px;} a{color:#2E5CD5;cursor: pointer;text-decoration: none} a:hover{text-decoration:underline; } body{ background: #fff; font-family: \\&quot;Century Gothic\\&quot;,\\&quot;Microsoft yahei\\&quot;; color: #333;font-size:18px;} h1{ font-size: 100px; font-weight: normal; margin-bottom: 12px; } p{ line-height: 1.6em; font-size: 42px }&lt;/style&gt;&lt;div style=\\&quot;padding: 24px 48px;\\&quot;&gt; &lt;h1&gt;:) &lt;/h1&gt;&lt;p&gt; ThinkPHP V6.1.0&lt;br/&gt;&lt;span style=\\&quot;font-size:30px;\\&quot;&gt;16\u8F7D\u521D\u5FC3\u4E0D\u6539 - \u4F60\u503C\u5F97\u4FE1\u8D56\u7684PHP\u6846\u67B6&lt;/span&gt;&lt;/p&gt;&lt;span style=\\&quot;font-size:25px;\\&quot;&gt;[ V6.0 \u7248\u672C\u7531 &lt;a href=\\&quot;https://www.yisu.com/\\&quot; target=\\&quot;yisu\\&quot;&gt;\u4EBF\u901F\u4E91&lt;/a&gt; \u72EC\u5BB6\u8D5E\u52A9\u53D1\u5E03 ]&lt;/span&gt;&lt;/div&gt;&lt;script type=\\&quot;text/javascript\\&quot; src=\\&quot;https://e.topthink.com/Public/static/client.js\\&quot;&gt;&lt;/script&gt;&lt;think id=\\&quot;ee9b1aa918103c4fc\\&quot;&gt;&lt;/think&gt;&quot;</span><span class="token punctuation">,</span>
                <span class="token property">&quot;ServiceID&quot;</span><span class="token operator">:</span> <span class="token string">&quot;demoService&quot;</span><span class="token punctuation">,</span>
                <span class="token property">&quot;ServiceName&quot;</span><span class="token operator">:</span> <span class="token string">&quot;demoService&quot;</span><span class="token punctuation">,</span>
                <span class="token property">&quot;ServiceTags&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;core.demo&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token property">&quot;Type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;http&quot;</span><span class="token punctuation">,</span>
                <span class="token property">&quot;Interval&quot;</span><span class="token operator">:</span> <span class="token string">&quot;5s&quot;</span><span class="token punctuation">,</span>
                <span class="token property">&quot;Timeout&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
                <span class="token property">&quot;ExposedPort&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
                <span class="token property">&quot;Definition&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token property">&quot;CreateIndex&quot;</span><span class="token operator">:</span> <span class="token number">30</span><span class="token punctuation">,</span>
                <span class="token property">&quot;ModifyIndex&quot;</span><span class="token operator">:</span> <span class="token number">31</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,2),h={href:"http://127.0.0.1:8087/consul/reg/demo",target:"_blank",rel:"noopener noreferrer"},y=s("http://127.0.0.1:8087/consul/reg/demo"),f=n("blockquote",null,[n("p",null,[s("\u8FD9\u4E2A\u4F1A\u6253\u5370\u4E00\u4E2A\u7A7A\u7684\u5B57\u7B26\u4E32\uFF0C\u7136\u540E\u518D\u53BB"),n("code",null,"consul"),s("\u91CC\u67E5\u770B\u662F\u5426\u6709\u4E0A\u9762\u56FE\u4E2D\u7684"),n("code",null,"demoService"),s("\u6CE8\u518C\uFF0C\u6709\u5C31\u4EE3\u8868\u6210\u529F\u4E86")])],-1),_=n("p",null,[n("img",{src:"https://virusoss.oss-cn-shanghai.aliyuncs.com/images/image-20221220220610387.png",alt:"image-20221220220610387",loading:"lazy"})],-1),$=n("p",null,[n("code",null,"consul"),s("\u4E5F\u4F1A\u8FDB\u884C\u5065\u5EB7\u68C0\u67E5\u3002")],-1);function w(T,x){const a=o("ExternalLinkIcon");return c(),l("div",null,[u,r,n("p",null,[k,n("a",d,[v,t(a)])]),m,n("ul",null,[n("li",null,[n("p",null,[n("a",b,[q,t(a)])]),g]),n("li",null,[n("p",null,[n("a",h,[y,t(a)])]),f])]),_,$])}var S=e(i,[["render",w],["__file","php-consule-base.html.vue"]]);export{S as default};
